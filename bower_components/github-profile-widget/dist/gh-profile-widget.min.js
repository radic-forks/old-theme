var GitHubWidget;!function(){GitHubWidget=function(e){var t="github-widget";this.defaultConfig={sortBy:"stars",reposHeaderText:"Most starred",maxRepos:5},e=e||this.defaultConfig,this.$template=document.getElementById(t),this.user=e.userName||this.$template.dataset.username,this.url={api:"https://api.github.com/users/"+this.user,langs:[]},this.error=null,this.data=null,this.profile={},this.langs={},this.init()},GitHubWidget.prototype.init=function(){this.load(),this.loadCSS(),this.render()},GitHubWidget.prototype.load=function(){var e=this.getURL(this.url.api);if(this.data=JSON.parse(e.responseText),200===e.status)this.error=null,this.loadRepos();else{var t=e.getResponseHeader("X-RateLimit-Remaining");if(this.error={message:this.data.message},0===Number(t)){var r=e.getResponseHeader("X-RateLimit-Reset");this.error.resetDate=new Date(1e3*r),this.error.message=this.error.message.split("(")[0]}404===e.status&&(this.error.isWrongUser=!0)}},GitHubWidget.prototype.loadRepos=function(){var e=this.getURL(this.data.repos_url);this.profile.repos=JSON.parse(e.responseText);for(var t in this.profile.repos)this.url.langs.push(this.profile.repos[t].languages_url);return this.profile.repos},GitHubWidget.prototype.getRepos=function(){return this.profile.repos},GitHubWidget.prototype.getTopLanguages=function(e){var t=[];this.url.langs.forEach(function(e){var s=this,a=new XMLHttpRequest;a.addEventListener("load",function(){var e=JSON.parse(a.responseText);t.push(e),t.length===s.url.langs.length&&r.bind(s)()},!1),a.open("GET",e,!0),a.send(null)},this);var r=function(){t.forEach(function(e){var t,r=0;for(t in e)void 0!==e[t]&&(r+=e[t],this.langs[t]=this.langs[t]||0);for(t in e)void 0!==e[t]&&(this.langs[t]+=e[t]/(1*r))},this),e()}},GitHubWidget.prototype.render=function(e){e=e||this.defaultConfig,console.log(e);for(var t=this.$template;t.hasChildNodes();)t.removeChild(t.firstChild);if(this.error){var r=document.createElement("div");if(r.className="error",r.innerHTML="<span>"+this.error.message+"</span>",this.error.isWrongUser&&(r.innerHTML="<span>Not found user: "+this.user+"</span>"),this.error.resetDate){var s=this.error.resetDate.getMinutes()-(new Date).getMinutes();s=0>s?60+s:s,r.innerHTML+='<span class="remain">Come back after '+s+" minutes</span>"}return t.appendChild(r),!1}var a=this.render.profile.bind(this)();if(this.getTopLanguages(function(){var e=this.render.langs.bind(this)();a.appendChild(e)}.bind(this)),t.appendChild(a),e.maxRepos>0){var i=this.render.repos.bind(this)(e.sortBy,e.maxRepos),n=document.createElement("span");n.className="header",n.appendChild(document.createTextNode(e.reposHeaderText+" repositories")),i.insertBefore(n,i.firstChild),t.appendChild(i)}},GitHubWidget.prototype.render.repos=function(e,t){var r=this.getRepos(),s=document.createElement("div");r.sort(function(t,r){return"stars"==e?r.stargazers_count-t.stargazers_count:new Date(r.updated_at).getTime()-new Date(t.updated_at).getTime()});for(var a=0;t>a&&r[a];a++){var i=new Date(r[a].updated_at),n=document.createElement("a");n.href=r[a].html_url,n.title=r[a].description,n.innerHTML+='<span class="repo-name">'+r[a].name+"</span>",n.innerHTML+='<span class="updated">Updated: '+i.toLocaleDateString()+"</span>",n.innerHTML+='<span class="star">'+r[a].stargazers_count+"</span>",s.appendChild(n)}return s.className="repos",s},GitHubWidget.prototype.render.profile=function(){var e=document.createElement("div"),t=document.createElement("a"),r=document.createElement("img"),s=document.createElement("div"),a=document.createElement("div"),i=document.createElement("a"),n=document.createElement("span");return t.href=this.data.html_url,t.className="name",t.appendChild(document.createTextNode(this.data.name)),r.src=this.data.avatar_url,r.className="avatar",i.href=t.href,i.className="follow-button",i.innerHTML="Follow @"+this.user,n.href=this.data.followers_url,n.className="followers",n.innerHTML=this.data.followers,a.className="followMe",a.appendChild(i),a.appendChild(n),e.appendChild(r),e.appendChild(t),e.appendChild(a),e.appendChild(s),e.classList.add("profile"),e},GitHubWidget.prototype.render.langs=function(){var e=document.createElement("ul"),t=[];for(var r in this.langs)t.push([r,this.langs[r]]);t.sort(function(e,t){return t[1]-e[1]});for(var s=0;3>s&&t[s];s++)e.innerHTML+="<li>"+t[s][0]+"</li>";return e.className="languages",e},GitHubWidget.prototype.getURL=function(e,t){t=t||!1;var r=new XMLHttpRequest;return r.open("GET",e,t),r.send(),r},GitHubWidget.prototype.loadCSS=function(){var e,t=document.createElement("link"),r=document.getElementsByTagName("script");return e=r[r.length-1].src,t.rel="stylesheet",t.href=e+"/../gh-profile-widget.css",document.head.appendChild(t),this.$template.className="gh-profile-widget",t.sheet}}();var widget=new GitHubWidget;